import{a as W,b as X,c as M,e as Y,f as Z,h as ee,i as te,j as ie,m as re,r as ne,t as oe}from"./chunk-JUWKGPSY.js";import{a as Q}from"./chunk-JWNTM4EV.js";import{a as G,b as x,g as J,h as z,i as U,n as f,o as K}from"./chunk-RGMM4CGJ.js";import{Bb as o,Cb as l,Db as d,Fb as b,Ib as L,Ja as s,Kb as V,X as c,Za as v,ba as p,bb as u,fa as m,fb as T,gb as n,hb as r,ib as g,ic as F,jc as q,k as B,lb as D,lc as A,mc as R,na as _,oa as E,ob as I,qb as P}from"./chunk-5MFQLEWO.js";var k=class i{static \u0275fac=function(e){return new(e||i)};static \u0275cmp=m({type:i,selectors:[["app-layout"]],standalone:!0,features:[b],decls:3,vars:0,template:function(e,a){e&1&&g(0,"app-navbar")(1,"router-outlet")(2,"app-footer")},dependencies:[Q,z,W]})};var S=class i{baseUrl=`${f.apiUrl}/subscription-plans`;http=p(x);constructor(){}getPlans(){return this.http.get(`${this.baseUrl}`)}getPlanById(t){return this.http.get(`${this.baseUrl}/${t}`)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=c({token:i,factory:i.\u0275fac,providedIn:"root"})};var y=class i{planIdSource=new B(null);currentPlanId=this.planIdSource.asObservable();constructor(){}changePlanId(t){this.planIdSource.next(t)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=c({token:i,factory:i.\u0275fac,providedIn:"root"})};function se(i,t){if(i&1){let e=D();n(0,"div",7)(1,"div",8)(2,"h2",9),o(3),r(),n(4,"p",10),o(5),r(),n(6,"div",11)(7,"span",12),o(8),r(),n(9,"span",13),o(10),r()()(),n(11,"div",8)(12,"p",14),o(13),r()(),n(14,"button",15),I("click",function(){let w=_(e).$implicit,ae=P();return E(ae.selectPlan(w.id))}),o(15),r()()}if(i&2){let e=t.$implicit;s(3),l(e.name),s(2),l(e.targetAudience),s(3),d("$",e.price,""),s(2),d("/",e.duration," month"),s(3),l(e.description),s(2),d(" Subscribe to ",e.name," ")}}var O=class i{plans=[];sharedDataService=p(y);planService=p(S);router=p(U);constructor(){}ngOnInit(){this.planService.getPlans().subscribe({next:t=>{this.plans=t,console.log("Planes cargados",t)},error:t=>console.error("Error al cargar los planes",t)})}selectPlan(t){this.sharedDataService.changePlanId(t),console.log("Plan seleccionado",t),this.router.navigate(["subscription/subscriptionPay"])}viewSubscriptionHistory(){this.router.navigate(["subscription/history"])}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=m({type:i,selectors:[["app-plan"]],standalone:!0,features:[b],decls:9,vars:1,consts:[[1,"container","mx-auto","px-4","py-8"],[1,"mb-8"],[1,"text-4xl","font-bold","text-center"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-8"],["class","relative rounded-2xl bg-white p-8 shadow-lg border border-gray-100 transition-all duration-300 hover:shadow-xl hover:-translate-y-1 hover:border-black",4,"ngFor","ngForOf"],[1,"mt-8","text-center"],[1,"py-2","px-4","rounded-lg","text-[#D55737]","font-semibold","border","border-[#D55737]","hover:bg-[#D55737]","hover:text-white","transition-colors","duration-200",3,"click"],[1,"relative","rounded-2xl","bg-white","p-8","shadow-lg","border","border-gray-100","transition-all","duration-300","hover:shadow-xl","hover:-translate-y-1","hover:border-black"],[1,"text-center","mb-8"],[1,"text-2xl","font-bold","text-gray-900","mb-2"],[1,"text-gray-600","mb-4"],[1,"flex","items-baseline","justify-center"],[1,"text-5xl","font-bold","text-gray-900"],[1,"text-gray-600","ml-2"],[1,"text-gray-600"],[1,"w-full","py-4","px-6","rounded-lg","text-white","font-semibold","transition-colors","duration-200","bg-[#D55737]","hover:bg-black",3,"click"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"div",1)(2,"h1",2),o(3,"Subscription Plans"),r()(),n(4,"div",3),v(5,se,16,6,"div",4),r(),n(6,"div",5)(7,"button",6),I("click",function(){return a.viewSubscriptionHistory()}),o(8," View Subscription History "),r()()()),e&2&&(s(5),u("ngForOf",a.plans))},dependencies:[F]})};var C=class i{baseURL=`${f.apiUrl}/user-subscription`;http=p(x);constructor(){}registerSubscription(t){return this.http.post(`${this.baseURL}`,t)}getHistory(){return this.http.get(`${this.baseURL}/user`)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=c({token:i,factory:i.\u0275fac,providedIn:"root"})};var j=class i{baseURL=`${f.apiUrl}/checkout`;http=p(x);createPaypalOrder(t){let e=new G;return e=e.append("purchaseId",t),e=e.append("returnUrl",f.paypalReturnUrl),e=e.append("cancelUrl",f.paypalReturnUrl),this.http.post(`${this.baseURL}/create`,null,{params:e})}capturePaypalOrder(t){return this.http.post(`${this.baseURL}/capture?orderId=${t}`,null)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=c({token:i,factory:i.\u0275fac,providedIn:"root"})};function le(i,t){i&1&&(n(0,"div")(1,"small",15),o(2,"Debes ingresar un n\xFAmero v\xE1lido de meses (m\xEDnimo 1)."),r()())}function ce(i,t){if(i&1){let e=D();n(0,"div",3)(1,"div",4)(2,"div",5)(3,"span",6),o(4),r()(),n(5,"div"),g(6,"img",7),r()(),n(7,"div",8)(8,"form",9),I("ngSubmit",function(){_(e);let w=P();return E(w.buySubscription())}),n(9,"div")(10,"label",10),o(11,"Meses"),r(),g(12,"input",11),v(13,le,3,0,"div",12),r(),n(14,"button",13),g(15,"img",14),r()()()()}if(i&2){let e,a=P();s(4),d("Plan ID: ",a.planId||"Sin seleccionar",""),s(4),u("formGroup",a.userSubscriptionForm),s(5),u("ngIf",((e=a.userSubscriptionForm.get("months"))==null?null:e.invalid)&&((e=a.userSubscriptionForm.get("months"))==null?null:e.touched)),s(),u("disabled",a.userSubscriptionForm.invalid||!a.planId)}}function me(i,t){i&1&&(n(0,"div")(1,"p",15),o(2,"Debes seleccionar un plan de suscripci\xF3n antes de continuar."),r()())}var N=class i{userId=0;planId;userSubscriptionForm;sharedDataService=p(y);planService=p(S);userSubscriptionService=p(C);formBuilder=p(ne);checkoutService=p(j);router=p(U);route=p(J);authService=p(K);ngOnInit(){this.userId=this.authService.getUser()?.id||0;let t=this.route.snapshot.queryParamMap.get("token"),e=this.route.snapshot.queryParamMap.get("PayerID");t&&e&&this.checkoutService.capturePaypalOrder(t).subscribe(a=>{a.completed&&this.router.navigate(["/subscription/subscriptionPay",a.purchaseId])}),this.userSubscriptionForm=this.formBuilder.group({months:[1,[M.required,M.min(1)]]}),this.sharedDataService.currentPlanId.subscribe(a=>{this.planId=a,console.log("Plan seleccionado",a)},a=>console.error("Error al obtener el plan",a))}buySubscription(){if(this.userSubscriptionForm.valid&&this.planId!==null){let t={subscriptionPlan_id:this.planId,months:this.userSubscriptionForm.value.months};console.log("Solicitud de suscripci\xF3n",t),this.userSubscriptionService.registerSubscription(t).subscribe(e=>{console.log("Suscripci\xF3n exitosa",e),this.checkoutService.createPaypalOrder(e.id).subscribe(a=>{window.location.href=a.paypalUrl})},e=>console.error("Error al registrar la suscripci\xF3n",e))}}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=m({type:i,selectors:[["app-buy-subscription"]],standalone:!0,features:[b],decls:6,vars:1,consts:[[1,"flex","flex-col","h-[100vh]","p-6"],[1,"flex","flex-row","justify-start","mb-4"],[1,"text-[30px]","font-bold"],[1,"grid","grid-cols-2","place-items-center"],[1,"grid","grid-cols-2","rounded-2xl","bg-white","p-8","shadow-lg","border","border-gray-100","max-w-[600px]"],[1,"space-y-2"],[1,"block","font-medium"],["src","assets/img/JobHub_tarjet.png","alt","tarjet",1,"w-[300px]"],[1,"rounded-2xl","bg-white","p-8","shadow-lg","border","border-gray-100","max-w-[300px]"],[3,"ngSubmit","formGroup"],["for","months",1,"block","text-sm","font-medium","text-gray-700"],["type","number","id","months","formControlName","months","placeholder","1",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","focus:border-indigo-500","focus:ring-indigo-500","sm:text-sm"],[4,"ngIf"],["type","submit",1,"w-full","bg-indigo-600","text-white","py-2","px-4","rounded-md","hover:bg-indigo-700","disabled:bg-gray-300",3,"disabled"],["src","https://www.paypalobjects.com/webstatic/en_US/i/buttons/checkout-logo-large.png","alt","PayPal Checkout"],[1,"text-red-500"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"div",1)(2,"h2",2),o(3,"Carrito de Compras"),r()(),v(4,ce,16,4,"div",3)(5,me,3,0,"div"),r()),e&2&&(s(4),T(a.planId!=null?4:5))},dependencies:[oe,ee,X,te,Y,Z,ie,re,R,q]})};function ue(i,t){if(i&1&&(n(0,"tr")(1,"td",10),o(2),r(),n(3,"td",10),o(4),r(),n(5,"td",10),o(6),r(),n(7,"td",10),o(8),r(),n(9,"td",10),o(10),r(),n(11,"td",10),o(12),L(13,"date"),r(),n(14,"td",10),o(15),r()()),i&2){let e=t.$implicit;s(2),l(e.id),s(2),l(e.role),s(2),l(e.subscriptionPlan_id),s(2),l(e.months),s(2),l(e.paymentStatus),s(2),l(V(13,7,e.lastUpdated,"short")),s(3),d("$",e.amount,"")}}var H=class i{subscriptions=[];subscriptionService=p(C);ngOnInit(){this.subscriptionService.getHistory().subscribe({next:t=>{this.subscriptions=t,console.log("Historial de suscripciones cargado",t)},error:t=>console.error("Error al cargar el historial de suscripciones",t)})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=m({type:i,selectors:[["app-subscription-history"]],standalone:!0,features:[b],decls:25,vars:1,consts:[[1,"container","mx-auto","px-4","py-8"],[1,"bg-white","shadow-md","rounded-lg","overflow-hidden"],[1,"p-6"],[1,"text-2xl","font-bold","mb-4"],[1,"overflow-x-auto"],[1,"w-full"],[1,"bg-gray-50"],[1,"px-6","py-3","text-left","text-xs","font-medium","text-gray-500","uppercase","tracking-wider"],[1,"bg-white","divide-y","divide-gray-200"],[4,"ngFor","ngForOf"],[1,"px-6","py-4","whitespace-nowrap"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),o(4,"Subscription History"),r()(),n(5,"div",4)(6,"table",5)(7,"thead",6)(8,"tr")(9,"th",7),o(10,"ID"),r(),n(11,"th",7),o(12,"Role"),r(),n(13,"th",7),o(14,"Plan ID"),r(),n(15,"th",7),o(16,"Months"),r(),n(17,"th",7),o(18,"Payment Status"),r(),n(19,"th",7),o(20,"Last Updated"),r(),n(21,"th",7),o(22,"Amount"),r()()(),n(23,"tbody",8),v(24,ue,16,10,"tr",9),r()()()()()),e&2&&(s(24),u("ngForOf",a.subscriptions))},dependencies:[R,F,A]})};var mt=[{path:"",component:k,children:[{path:"",redirectTo:"plans",pathMatch:"full"},{path:"plans",component:O},{path:"subscriptionPay",component:N},{path:"history",component:H}]}];export{mt as subscriptionPlanRoutes};
